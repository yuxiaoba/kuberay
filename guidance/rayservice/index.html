
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ray-project.github.io/kuberay/guidance/rayservice/">
      
      
        <link rel="prev" href="../../components/cli/">
      
      
        <link rel="next" href="../rayjob/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>RayService - KubeRay Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ray-services-alpha" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="KubeRay Docs" class="md-header__button md-logo" aria-label="KubeRay Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            KubeRay Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              RayService
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ray-project/kuberay" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    ray-project/kuberay
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        Home
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../components/operator/" class="md-tabs__link">
        Components
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="./" class="md-tabs__link md-tabs__link--active">
        Features
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../troubleshooting/" class="md-tabs__link">
      Troubleshooting
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../design/protobuf-grpc-service/" class="md-tabs__link">
        Design
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../development/development/" class="md-tabs__link">
        Development
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="KubeRay Docs" class="md-nav__button md-logo" aria-label="KubeRay Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    KubeRay Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ray-project/kuberay" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    ray-project/kuberay
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" tabindex="0" aria-expanded="false">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Home" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_1_2" type="checkbox" id="__nav_1_2" >
      
      
      
        <label class="md-nav__link" for="__nav_1_2" tabindex="0" aria-expanded="false">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_1_2_1" type="checkbox" id="__nav_1_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1_2_1" tabindex="0" aria-expanded="false">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Installation" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_2_1">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/installation/" class="md-nav__link">
        YAML
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/helm/" class="md-nav__link">
        Helm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/helm-cluster/" class="md-nav__link">
        Helm (Cluster)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/docker/" class="md-nav__link">
        Docker Images
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" tabindex="0" aria-expanded="false">
          Components
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Components" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Components
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../components/operator/" class="md-nav__link">
        KubeRay Operator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../components/apiserver/" class="md-nav__link">
        KubeRay API Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../components/cli/" class="md-nav__link">
        KubeRay CLI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" tabindex="0" aria-expanded="true">
          Features
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Features" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Features
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          RayService
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        RayService
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ray-services-alpha" class="md-nav__link">
    Ray Services (alpha)
  </a>
  
    <nav class="md-nav" aria-label="Ray Services (alpha)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-a-rayservice" class="md-nav__link">
    What is a RayService?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-does-the-rayservice-provide" class="md-nav__link">
    What does the RayService provide?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-the-operator" class="md-nav__link">
    Deploy the Operator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-an-example-cluster" class="md-nav__link">
    Run an Example Cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-user-services" class="md-nav__link">
    Access User Services
  </a>
  
    <nav class="md-nav" aria-label="Access User Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-a-curl-pod" class="md-nav__link">
    Run a Curl Pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-port-forwarding" class="md-nav__link">
    Use Port Forwarding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-ray-dashboard" class="md-nav__link">
    Access Ray Dashboard
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-ray-serve-config" class="md-nav__link">
    Update Ray Serve config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upgrade-rayservice-raycluster-config" class="md-nav__link">
    Upgrade RayService RayCluster Config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rayservice-observability" class="md-nav__link">
    RayService Observability
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-the-rayservice-instance" class="md-nav__link">
    Delete the RayService Instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-the-operator" class="md-nav__link">
    Delete the Operator
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rayjob/" class="md-nav__link">
        RayJob
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gcs-ft/" class="md-nav__link">
        Ray GCS Fault Tolerance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../autoscaler/" class="md-nav__link">
        Autoscaling
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3_5" type="checkbox" id="__nav_3_5" >
      
      
      
        <label class="md-nav__link" for="__nav_3_5" tabindex="0" aria-expanded="false">
          Networking
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Networking" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Networking
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ingress/" class="md-nav__link">
        Ingress
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tls/" class="md-nav__link">
        TLS
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3_6" type="checkbox" id="__nav_3_6" >
      
      
      
        <label class="md-nav__link" for="__nav_3_6" tabindex="0" aria-expanded="false">
          Monitoring and Observability
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Monitoring and Observability" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Monitoring and Observability
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../observability/" class="md-nav__link">
        Observability
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../prometheus-grafana/" class="md-nav__link">
        Prometheus and Grafana
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3_7" type="checkbox" id="__nav_3_7" >
      
      
      
        <label class="md-nav__link" for="__nav_3_7" tabindex="0" aria-expanded="false">
          Security
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Security" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          Security
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aws-eks-iam/" class="md-nav__link">
        IAM Roles (AWS EKS)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pod-security/" class="md-nav__link">
        Pod Security
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3_8" type="checkbox" id="__nav_3_8" >
      
      
      
        <label class="md-nav__link" for="__nav_3_8" tabindex="0" aria-expanded="false">
          Integrations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Integrations" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_8">
          <span class="md-nav__icon md-icon"></span>
          Integrations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kuberay-with-MCAD/" class="md-nav__link">
        KubeRay with MCAD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../volcano-integration/" class="md-nav__link">
        KubeRay with Volcano
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubeflow-integration/" class="md-nav__link">
        Kubeflow Integration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3_9" type="checkbox" id="__nav_3_9" >
      
      
      
        <label class="md-nav__link" for="__nav_3_9" tabindex="0" aria-expanded="false">
          Best Practices
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Best Practices" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_9">
          <span class="md-nav__icon md-icon"></span>
          Best Practices
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pod-command/" class="md-nav__link">
        Executing Commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../best-practice/worker-head-reconnection/" class="md-nav__link">
        Worker Reconnection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" tabindex="0" aria-expanded="false">
          Design
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Design" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Design
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design/protobuf-grpc-service/" class="md-nav__link">
        Core API and Backend Service
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" tabindex="0" aria-expanded="false">
          Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Development" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/development/" class="md-nav__link">
        Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_6_2" type="checkbox" id="__nav_6_2" >
      
      
      
        <label class="md-nav__link" for="__nav_6_2" tabindex="0" aria-expanded="false">
          Release Process
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Release Process" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Release Process
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/release/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release/changelog/" class="md-nav__link">
        Generating the Changelog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release/helm-chart/" class="md-nav__link">
        Releasing the Helm Chart
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ray-services-alpha" class="md-nav__link">
    Ray Services (alpha)
  </a>
  
    <nav class="md-nav" aria-label="Ray Services (alpha)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-a-rayservice" class="md-nav__link">
    What is a RayService?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-does-the-rayservice-provide" class="md-nav__link">
    What does the RayService provide?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-the-operator" class="md-nav__link">
    Deploy the Operator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-an-example-cluster" class="md-nav__link">
    Run an Example Cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-user-services" class="md-nav__link">
    Access User Services
  </a>
  
    <nav class="md-nav" aria-label="Access User Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-a-curl-pod" class="md-nav__link">
    Run a Curl Pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-port-forwarding" class="md-nav__link">
    Use Port Forwarding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-ray-dashboard" class="md-nav__link">
    Access Ray Dashboard
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-ray-serve-config" class="md-nav__link">
    Update Ray Serve config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upgrade-rayservice-raycluster-config" class="md-nav__link">
    Upgrade RayService RayCluster Config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rayservice-observability" class="md-nav__link">
    RayService Observability
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-the-rayservice-instance" class="md-nav__link">
    Delete the RayService Instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-the-operator" class="md-nav__link">
    Delete the Operator
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  





  <h1>RayService</h1>

<h2 id="ray-services-alpha">Ray Services (alpha)<a class="headerlink" href="#ray-services-alpha" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Note: This is the alpha version of Ray Services. There will be ongoing improvements for Ray Services in the future releases.</p>
</blockquote>
<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>Ray 2.0 or newer.</li>
<li>KubeRay 0.6.0 or newer.</li>
</ul>
<h3 id="what-is-a-rayservice">What is a RayService?<a class="headerlink" href="#what-is-a-rayservice" title="Permanent link">&para;</a></h3>
<p>A RayService manages 2 things:</p>
<ul>
<li><strong>Ray Cluster</strong>: Manages resources in a Kubernetes cluster.</li>
<li><strong>Ray Serve Applications</strong>: Manages users' applications.</li>
</ul>
<h3 id="what-does-the-rayservice-provide">What does the RayService provide?<a class="headerlink" href="#what-does-the-rayservice-provide" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Kubernetes-native support for Ray clusters and Ray Serve applications:</strong> After using a Kubernetes config to define a Ray cluster and its Ray Serve applications, you can use <code>kubectl</code> to create the cluster and its applications.</li>
<li><strong>In-place update for Ray Serve applications:</strong> Users can update the Ray Serve config in the RayService CR config and use <code>kubectl apply</code> to update the applications.</li>
<li><strong>Zero downtime upgrade for Ray clusters:</strong> Users can update the Ray cluster config in the RayService CR config and use <code>kubectl apply</code> to update the cluster. RayService will temporarily create a pending cluster and wait for it to be ready, then switch traffic to the new cluster and terminate the old one.</li>
<li><strong>Services HA:</strong> RayService will monitor the Ray cluster and Serve deployments' health statuses. If RayService detects an unhealthy status for a period of time, RayService will try to create a new Ray cluster and switch traffic to the new cluster when it is ready.</li>
</ul>
<h3 id="deploy-the-operator">Deploy the Operator<a class="headerlink" href="#deploy-the-operator" title="Permanent link">&para;</a></h3>
<p>Follow <a href="../../helm-chart/kuberay-operator/README.md">this document</a> to install the nightly KubeRay operator via 
Helm. Note that sample RayService in this guide uses <code>serveConfigV2</code> to specify a multi-application Serve config.
This will be first supported in Kuberay 0.6.0, and is currently supported only on the nightly KubeRay operator.</p>
<p>Check that the controller is running.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>deployments<span class="w"> </span>-n<span class="w"> </span>ray-system
NAME<span class="w">           </span>READY<span class="w">   </span>UP-TO-DATE<span class="w">   </span>AVAILABLE<span class="w">   </span>AGE
ray-operator<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span><span class="m">1</span><span class="w">            </span><span class="m">1</span><span class="w">           </span>40s

$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>ray-system
NAME<span class="w">                            </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE
ray-operator-75dbbf8587-5lrvn<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>31s
</code></pre></div>
<h3 id="run-an-example-cluster">Run an Example Cluster<a class="headerlink" href="#run-an-example-cluster" title="Permanent link">&para;</a></h3>
<p>In this guide we will be working with the sample RayService defined by <a href="https://github.com/ray-project/kuberay/blob/master/ray-operator/config/samples/ray_v1alpha1_rayservice.yaml">ray_v1alpha1_rayservice.yaml</a>.</p>
<p>Let's first take a look at the Ray Serve config embedded in the RayService yaml. At a high level (without digging too deep into the details about the deployments in each application), there are two applications: a fruit stand app and a calculator app. The fruit stand application is imported from the <code>fruit.py</code> file in the <a href="https://github.com/ray-project/test_dag/tree/master">test_dag</a> repo, and it's hosted at the route prefix <code>/fruit</code>. Similarly, the calculator app is imported from the <code>conditional_dag.py</code> file in the same repo, and it's hosted at the route prefix <code>/calc</code>.
<div class="highlight"><pre><span></span><code><span class="nt">serveConfigV2</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">  </span><span class="no">applications:</span>
<span class="w">    </span><span class="no">- name: fruit_app</span>
<span class="w">      </span><span class="no">import_path: fruit.deployment_graph</span>
<span class="w">      </span><span class="no">route_prefix: /fruit</span>
<span class="w">      </span><span class="no">runtime_env:</span>
<span class="w">        </span><span class="no">working_dir: &quot;https://github.com/ray-project/test_dag/archive/41d09119cbdf8450599f993f51318e9e27c59098.zip&quot;</span>
<span class="w">      </span><span class="no">deployments: ...</span>
<span class="w">    </span><span class="no">- name: math_app</span>
<span class="w">      </span><span class="no">import_path: conditional_dag.serve_dag</span>
<span class="w">      </span><span class="no">route_prefix: /calc</span>
<span class="w">      </span><span class="no">runtime_env:</span>
<span class="w">        </span><span class="no">working_dir: &quot;https://github.com/ray-project/test_dag/archive/41d09119cbdf8450599f993f51318e9e27c59098.zip&quot;</span>
<span class="w">      </span><span class="no">deployments: ...</span>
</code></pre></div></p>
<p>To start a RayService and deploy these two applications, run the following command:
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>config/samples/ray_v1alpha1_rayservice.yaml
</code></pre></div></p>
<p>List running RayServices to check on your new service <code>rayservice-sample</code>.
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>rayservice
NAME<span class="w">                </span>AGE
rayservice-sample<span class="w">   </span>7s
</code></pre></div></p>
<p>The created RayService should include a head pod, a worker pod, and four services.
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>pods
NAME<span class="w">                                                      </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE
ervice-sample-raycluster-qd2vl-worker-small-group-bxpp6<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>24m
rayservice-sample-raycluster-qd2vl-head-45hj4<span class="w">             </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>24m

$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>services
NAME<span class="w">                                               </span>TYPE<span class="w">        </span>CLUSTER-IP<span class="w">       </span>EXTERNAL-IP<span class="w">   </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">                                          </span>AGE
kubernetes<span class="w">                                         </span>ClusterIP<span class="w">   </span><span class="m">10</span>.100.0.1<span class="w">       </span>&lt;none&gt;<span class="w">        </span><span class="m">443</span>/TCP<span class="w">                                          </span>62d
<span class="c1"># A head node service maintained by the RayService.</span>
rayservice-sample-head-svc<span class="w">                         </span>ClusterIP<span class="w">   </span><span class="m">10</span>.100.34.24<span class="w">     </span>&lt;none&gt;<span class="w">        </span><span class="m">6379</span>/TCP,8265/TCP,10001/TCP,8000/TCP,52365/TCP<span class="w">   </span>24m
<span class="c1"># A dashboard agent service maintained by the RayCluster.</span>
rayservice-sample-raycluster-qd2vl-dashboard-svc<span class="w">   </span>ClusterIP<span class="w">   </span><span class="m">10</span>.100.109.177<span class="w">   </span>&lt;none&gt;<span class="w">        </span><span class="m">52365</span>/TCP<span class="w">                                        </span>24m
<span class="c1"># A head node service maintained by the RayCluster.</span>
rayservice-sample-raycluster-qd2vl-head-svc<span class="w">        </span>ClusterIP<span class="w">   </span><span class="m">10</span>.100.180.221<span class="w">   </span>&lt;none&gt;<span class="w">        </span><span class="m">6379</span>/TCP,8265/TCP,10001/TCP,8000/TCP,52365/TCP<span class="w">   </span>24m
<span class="c1"># A serve service maintained by the RayService.</span>
rayservice-sample-serve-svc<span class="w">                        </span>ClusterIP<span class="w">   </span><span class="m">10</span>.100.39.92<span class="w">     </span>&lt;none&gt;<span class="w">        </span><span class="m">8000</span>/TCP<span class="w">                                         </span>24m
</code></pre></div></p>
<blockquote>
<p>Note: Default ports and their definitions. </p>
</blockquote>
<table>
<thead>
<tr>
<th>Port</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td>6379</td>
<td>Ray GCS</td>
</tr>
<tr>
<td>8265</td>
<td>Ray Dashboard</td>
</tr>
<tr>
<td>10001</td>
<td>Ray Client</td>
</tr>
<tr>
<td>8000</td>
<td>Ray Serve</td>
</tr>
<tr>
<td>52365</td>
<td>Ray Dashboard Agent</td>
</tr>
</tbody>
</table>
<p>Get information about the RayService using its name.
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>describe<span class="w"> </span>rayservices<span class="w"> </span>rayservice-sample
</code></pre></div></p>
<h3 id="access-user-services">Access User Services<a class="headerlink" href="#access-user-services" title="Permanent link">&para;</a></h3>
<p>The users' traffic can go through the <code>serve</code> service (e.g. <code>rayservice-sample-serve-svc</code>).</p>
<h4 id="run-a-curl-pod">Run a Curl Pod<a class="headerlink" href="#run-a-curl-pod" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>run<span class="w"> </span>curl<span class="w"> </span>--image<span class="o">=</span>radial/busyboxplus:curl<span class="w"> </span>-i<span class="w"> </span>--tty
</code></pre></div>
<p>Or if you already have a curl pod running, you can login using <code>kubectl exec -it curl sh</code>.</p>
<p>You can query the two applications in your service at their respective endpoints. Query the fruit stand app with the route prefix <code>/fruit</code>:
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="w"> </span>root@curl:/<span class="w"> </span><span class="o">]</span>$<span class="w"> </span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span>rayservice-sample-serve-svc.default.svc.cluster.local:8000/fruit/<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;[&quot;MANGO&quot;, 2]&#39;</span>
&gt;<span class="w"> </span><span class="m">6</span>
</code></pre></div>
Query the calculator app with the route prefix <code>/calc</code>:
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="w"> </span>root@curl:/<span class="w"> </span><span class="o">]</span>$<span class="w"> </span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span>rayservice-sample-serve-svc.default.svc.cluster.local:8000/calc/<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;[&quot;MUL&quot;, 3]&#39;</span>
&gt;<span class="w"> </span><span class="m">15</span><span class="w"> </span>pizzas<span class="w"> </span>please!
</code></pre></div>
You should get the responses <code>6</code> and <code>15 pizzas please!</code>.</p>
<h4 id="use-port-forwarding">Use Port Forwarding<a class="headerlink" href="#use-port-forwarding" title="Permanent link">&para;</a></h4>
<p>Set up Kubernetes port forwarding.
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>port-forward<span class="w"> </span>service/rayservice-sample-serve-svc<span class="w"> </span><span class="m">8000</span>
</code></pre></div>
For the fruit example deployment, you can try the following requests:
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="w"> </span>root@curl:/<span class="w"> </span><span class="o">]</span>$<span class="w"> </span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span>localhost:8000/fruit/<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;[&quot;MANGO&quot;, 2]&#39;</span>
&gt;<span class="w"> </span><span class="m">6</span>
<span class="o">[</span><span class="w"> </span>root@curl:/<span class="w"> </span><span class="o">]</span>$<span class="w"> </span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span>localhost:8000/calc/<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;[&quot;MUL&quot;, 3]&#39;</span>
&gt;<span class="w"> </span><span class="m">15</span><span class="w"> </span>pizzas<span class="w"> </span>please!
</code></pre></div></p>
<blockquote>
<p>Note:
<code>serve-svc</code> is HA in general. It will do traffic routing among all the workers which have serve deployments and will always try to point to the healthy cluster, even during upgrading or failing cases. 
You can set <code>serviceUnhealthySecondThreshold</code> to define the threshold of seconds that the serve deployments fail. You can also set <code>deploymentUnhealthySecondThreshold</code> to define the threshold of seconds that Ray fails to deploy any serve deployments.</p>
</blockquote>
<h3 id="access-ray-dashboard">Access Ray Dashboard<a class="headerlink" href="#access-ray-dashboard" title="Permanent link">&para;</a></h3>
<p>Set up Kubernetes port forwarding for the dashboard.
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>port-forward<span class="w"> </span>service/rayservice-sample-head-svc<span class="w"> </span><span class="m">8265</span>
</code></pre></div>
Access the dashboard using a web browser at <code>localhost:8265</code>.</p>
<h3 id="update-ray-serve-config">Update Ray Serve config<a class="headerlink" href="#update-ray-serve-config" title="Permanent link">&para;</a></h3>
<p>You can update the applications in the <code>serveConfigV2</code> in your RayService config file.
For example, update the price of mangos from <code>3</code> to <code>4</code> for the fruit app in <a href="https://github.com/ray-project/kuberay/blob/master/ray-operator/config/samples/ray_v1alpha1_rayservice.yaml">ray_v1alpha1_rayservice.yaml</a>:
<div class="highlight"><pre><span></span><code>-<span class="w"> </span>name:<span class="w"> </span>MangoStand
<span class="w">  </span>num_replicas:<span class="w"> </span><span class="m">1</span>
<span class="w">  </span>user_config:
<span class="w">    </span>price:<span class="w"> </span><span class="m">4</span>
</code></pre></div></p>
<p>Use <code>kubectl apply</code> to update your RayService and <code>kubectl describe  rayservices rayservice-sample</code> to take a look at the RayService's information. It should look similar to:
<div class="highlight"><pre><span></span><code>serveDeploymentStatuses:
-<span class="w"> </span>healthLastUpdateTime:<span class="w"> </span><span class="s2">&quot;2022-07-18T21:51:37Z&quot;</span>
<span class="w">  </span>lastUpdateTime:<span class="w"> </span><span class="s2">&quot;2022-07-18T21:51:41Z&quot;</span>
<span class="w">  </span>name:<span class="w"> </span>MangoStand
<span class="w">  </span>status:<span class="w"> </span>UPDATING
</code></pre></div></p>
<p>After it finishes deployment, let's send a request again. In the curl pod from earlier, run:
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="w"> </span>root@curl:/<span class="w"> </span><span class="o">]</span>$<span class="w"> </span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span>rayservice-sample-serve-svc.default.svc.cluster.local:8000/fruit/<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;[&quot;MANGO&quot;, 2]&#39;</span>
&gt;<span class="w"> </span><span class="m">8</span>
</code></pre></div>
Or if using port forwarding:
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span>localhost:8000/fruit/<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;[&quot;MANGO&quot;, 2]&#39;</span>
&gt;<span class="w"> </span><span class="m">8</span>
</code></pre></div>
You should now get <code>8</code> as a result.</p>
<h3 id="upgrade-rayservice-raycluster-config">Upgrade RayService RayCluster Config<a class="headerlink" href="#upgrade-rayservice-raycluster-config" title="Permanent link">&para;</a></h3>
<p>You can update the <code>rayClusterConfig</code> in your RayService config file.
For example, you can increase the number of workers to 2:
<div class="highlight"><pre><span></span><code>workerGroupSpecs:
<span class="w">  </span><span class="c1"># the pod replicas in this group typed worker</span>
<span class="w">  </span>-<span class="w"> </span>replicas:<span class="w"> </span><span class="m">2</span>
</code></pre></div></p>
<p>Use <code>kubectl apply</code> to update your RayService and <code>kubectl describe  rayservices rayservice-sample</code> to take a look at the RayService's information. It should look similar to:
<div class="highlight"><pre><span></span><code><span class="w">  </span>pendingServiceStatus:
<span class="w">    </span>appStatus:<span class="w"> </span><span class="o">{}</span>
<span class="w">    </span>dashboardStatus:
<span class="w">      </span>healthLastUpdateTime:<span class="w"> </span><span class="s2">&quot;2022-07-18T21:54:53Z&quot;</span>
<span class="w">      </span>lastUpdateTime:<span class="w"> </span><span class="s2">&quot;2022-07-18T21:54:54Z&quot;</span>
<span class="w">    </span>rayClusterName:<span class="w"> </span>rayservice-sample-raycluster-bshfr
<span class="w">    </span>rayClusterStatus:<span class="w"> </span><span class="o">{}</span>
</code></pre></div>
You can see the RayService is preparing a pending cluster. Once the pending cluster is healthy, the RayService will make it the active cluster and terminate the previous one.</p>
<h3 id="rayservice-observability">RayService Observability<a class="headerlink" href="#rayservice-observability" title="Permanent link">&para;</a></h3>
<p>You can use <code>kubectl logs</code> to check the operator logs or the head/worker nodes logs.
You can also use <code>kubectl describe rayservices rayservice-sample</code> to check the states and event logs of your RayService instance.</p>
<p>For Ray Serve monitoring, you can refer to the <a href="https://docs.ray.io/en/master/ray-observability/state/state-api.html">Ray observability documentation</a>.
To run Ray state APIs, log in to the head pod by running <code>kubectl exec -it &lt;head-node-pod&gt; bash</code> and use the Ray CLI or you can run commands locally using <code>kubectl exec -it &lt;head-node-pod&gt; -- &lt;ray state api&gt;</code>.</p>
<p>For example, <code>kubectl exec -it &lt;head-node-pod&gt; -- ray summary tasks</code> outputs the following:
<div class="highlight"><pre><span></span><code><span class="o">========</span><span class="w"> </span>Tasks<span class="w"> </span>Summary:<span class="w"> </span><span class="m">2022</span>-07-28<span class="w"> </span><span class="m">15</span>:10:24.801670<span class="w"> </span><span class="o">========</span>
Stats:
------------------------------------
total_actor_scheduled:<span class="w"> </span><span class="m">17</span>
total_actor_tasks:<span class="w"> </span><span class="m">5</span>
total_tasks:<span class="w"> </span><span class="m">0</span>


Table<span class="w"> </span><span class="o">(</span>group<span class="w"> </span>by<span class="w"> </span>func_name<span class="o">)</span>:
------------------------------------
<span class="w">    </span>FUNC_OR_CLASS_NAME<span class="w">                 </span>STATE_COUNTS<span class="w">    </span>TYPE
<span class="m">0</span><span class="w">   </span>ServeController.listen_for_change<span class="w">  </span>RUNNING:<span class="w"> </span><span class="m">5</span><span class="w">      </span>ACTOR_TASK
<span class="m">1</span><span class="w">   </span>ServeReplica:MangoStand.__init__<span class="w">   </span>FINISHED:<span class="w"> </span><span class="m">3</span><span class="w">     </span>ACTOR_CREATION_TASK
<span class="m">2</span><span class="w">   </span>HTTPProxyActor.__init__<span class="w">            </span>FINISHED:<span class="w"> </span><span class="m">2</span><span class="w">     </span>ACTOR_CREATION_TASK
<span class="m">3</span><span class="w">   </span>ServeReplica:PearStand.__init__<span class="w">    </span>FINISHED:<span class="w"> </span><span class="m">3</span><span class="w">     </span>ACTOR_CREATION_TASK
<span class="m">4</span><span class="w">   </span>ServeReplica:OrangeStand.__init__<span class="w">  </span>FINISHED:<span class="w"> </span><span class="m">3</span><span class="w">     </span>ACTOR_CREATION_TASK
<span class="m">5</span><span class="w">   </span>ServeReplica:FruitMarket.__init__<span class="w">  </span>FINISHED:<span class="w"> </span><span class="m">3</span><span class="w">     </span>ACTOR_CREATION_TASK
<span class="m">6</span><span class="w">   </span>ServeReplica:DAGDriver.__init__<span class="w">    </span>FINISHED:<span class="w"> </span><span class="m">2</span><span class="w">     </span>ACTOR_CREATION_TASK
<span class="m">7</span><span class="w">   </span>ServeController.__init__<span class="w">           </span>FINISHED:<span class="w"> </span><span class="m">1</span><span class="w">     </span>ACTOR_CREATION_TASK
</code></pre></div></p>
<h3 id="delete-the-rayservice-instance">Delete the RayService Instance<a class="headerlink" href="#delete-the-rayservice-instance" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>$ kubectl delete -f config/samples/ray_v1alpha1_rayservice.yaml
</code></pre></div>
<h3 id="delete-the-operator">Delete the Operator<a class="headerlink" href="#delete-the-operator" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>$ kubectl delete -k &quot;github.com/ray-project/kuberay/ray-operator/config/default&quot;
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>